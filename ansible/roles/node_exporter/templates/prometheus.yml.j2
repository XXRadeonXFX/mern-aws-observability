global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # Monitor Prometheus itself
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  # Monitor Node Exporter on all hosts (DB + Web)
  - job_name: "node_exporter"
    static_configs:
      - targets:
{% for host in groups['all'] %}
          - "{{ hostvars[host].ansible_host }}:9100"
{% endfor %}

  # Monitor MongoDB Exporter on DB host(s)
  - job_name: "mongodb"
    static_configs:
      - targets:
{% for host in groups['db'] %}
          - "{{ hostvars[host].ansible_host }}:9216"
{% endfor %}
